!function(){function e(e){e.insertContent('[gistpen id="'+t+'"]'),e.windowManager.close()}var n,t;tinymce.create("tinymce.plugins.wp_gistpen",{init:function(i){i.addButton("wp_gistpen",{icon:"icons dashicons-edit",tooltip:"Insert Gistpen",cmd:"wp_gistpen"}),i.addCommand("wp_gistpen",function(){i.windowManager.open({title:"Insert Gistpen",width:.7*jQuery(window).width(),height:.7*(jQuery(window).height()-36-50),inline:1,id:"wp-gistpen-insert-dialog",buttons:[{text:"Insert",id:"wp-gistpen-button-insert","class":"insert",onclick:function(){t=jQuery('input[name="gistpen_id"]:checked').val(),"new_gistpen"===t?(jQuery("#wp-gistpen-button-insert, #wp-gistpen-button-cancel").hide(),jQuery("#wp-gistpen-insert-dialog .mce-foot .mce-container-body").append('<div class="posting">Inserting post... <span class="spinner"></span></div>'),jQuery.post(ajaxurl,{action:"create_gistpen_ajax",gistpen_nonce:jQuery.trim(jQuery("#_ajax_wp_gistpen").val()),gistpen_title:jQuery('input[name="gistpen_title"]').val(),gistpen_content:jQuery('textarea[name="gistpen_content"]').val(),gistpen_description:jQuery('textarea[name="gistpen_description"]').val(),gistpen_language:jQuery('select[name="gistpen_language"]').val()},function(n){t=n,e(i)})):e(i)}},{text:"Cancel",id:"wp-gistpen-button-cancel",onclick:"close"}]});var s=jQuery("#wp-gistpen-insert-dialog-body").append('<div class="loading">Loading... <span class="spinner"></span></div>');jQuery.post(ajaxurl,{action:"gistpen_insert_dialog"},function(e){n=e,s.children(".loading").remove(),s.append(n),jQuery(".spinner").hide();var t=jQuery("#gistpen-search-btn");t.click(function(e){e.preventDefault(),jQuery("#select-gistpen ul.gistpen-list > li").not(".create_new_gistpen").hide(),t.children("button").hide(),jQuery(".gistpen-search-wrap .spinner").show(),jQuery.post(ajaxurl,{action:"search_gistpen_ajax",gistpen_nonce:jQuery.trim(jQuery("#_ajax_wp_gistpen").val()),gistpen_search_term:jQuery("#gistpen-search-field").val()},function(e){jQuery("#select-gistpen ul.gistpen-list").prepend(e),jQuery(".gistpen-search-wrap .spinner").hide(),t.children("button").show()})})})})}}),tinymce.PluginManager.add("wp_gistpen",tinymce.plugins.wp_gistpen)}();