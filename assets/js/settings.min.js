window.wpgpSettings={},jQuery(function(e){"use strict";var t=window.wpgpSettings;Prism.hooks.add("after-highlight",function(e){var s=new t.Preview;s.setClickHandlers()});var s=new t.Export;s.setClickHandlers();var r=new t.Import;r.setClickHandlers()}),function(e){var t=Backbone.Model.extend({initialize:function(e){this.startBtn=jQuery("#export-gistpens"),this.wrap=jQuery(".wpgp-wrap"),this.templates={},this.templates.header=jQuery("script#exportHeaderTemplate"),this.templates.status=jQuery("script#statusTemplate")},setClickHandlers:function(){var e=this;this.startBtn.length&&(this.startBtn.prop("disabled",!0),this.getGistpenIDs(),this.startBtn.click(function(t){t.preventDefault(),e.wrap.html(""),e.appendHeader(),e.gistpenIDs.forEach(function(t){e.exportID(t)})}))},getGistpenIDs:function(){var e=this;jQuery.post(ajaxurl,{action:"get_gistpens_missing_gist_id",nonce:jQuery("#_ajax_wp_gistpen").val()},function(t){!1===t.success?e.startBtn.val(t.data.message):(e.gistpenIDs=t.data.ids,e.startBtn.prop("disabled",!1))})},appendHeader:function(){var e=this,t=_.template(this.templates.header.html());this.header=jQuery(t({}).trim()).appendTo(this.wrap),this.backLink=this.header.find("a"),this.$progress=this.header.find("#progressbar"),this.$progressLabel=this.header.find(".progress-label"),this.$status=jQuery("#export-status");this.$progress.progressbar({max:e.gistpenIDs.length,value:0,enable:!0})},exportID:function(e){var t=this;jQuery.ajaxq("export",{url:ajaxurl,type:"POST",data:{action:"create_gist_from_gistpen_id",nonce:jQuery("#_ajax_wp_gistpen").val(),gistpen_id:e},success:function(e){t.updateProgress(e)},error:function(e){jQuery.ajaxq.abort("export"),t.updateProgress(e)}})},updateProgress:function(e){var t=_.template(this.templates.status.html());this.$progress.progressbar("value",this.$progress.progressbar("value")+1),this.$status.append(t({status_code:e.data.code,status_message:e.data.message}).trim())}});window.wpgpSettings.Export=t}(jQuery),function(e){var t=Backbone.Model.extend({initialize:function(e){this.startBtn=jQuery("#import-gists"),this.wrap=jQuery(".wpgp-wrap"),this.templates={},this.templates.header=jQuery("script#importHeaderTemplate"),this.templates.status=jQuery("script#statusTemplate")},setClickHandlers:function(){var e=this;this.startBtn.length&&(this.startBtn.prop("disabled",!0),this.getGistIDs(),this.startBtn.click(function(t){t.preventDefault(),e.wrap.html(""),e.appendHeader(),e.gistIDs.forEach(function(t){e.importID(t)})}))},getGistIDs:function(){var e=this;jQuery.post(ajaxurl,{action:"get_new_user_gists",nonce:jQuery("#_ajax_wp_gistpen").val()},function(t){!1===t.success?e.startBtn.val(t.data.message):(e.gistIDs=t.data.gist_ids,e.startBtn.prop("disabled",!1))})},appendHeader:function(){var e=this,t=_.template(this.templates.header.html());this.header=jQuery(t({}).trim()).appendTo(this.wrap),this.backLink=this.header.find("a"),this.$progress=this.header.find("#progressbar"),this.$progressLabel=this.header.find(".progress-label"),this.$status=jQuery("#import-status");this.$progress.progressbar({max:e.gistIDs.length,value:0,enable:!0})},importID:function(e){var t=this;jQuery.ajaxq("import",{url:ajaxurl,type:"POST",data:{action:"import_gist",nonce:jQuery("#_ajax_wp_gistpen").val(),gist_id:e},success:function(e){t.updateProgress(e)},error:function(e){jQuery.ajaxq.abort("import"),t.updateProgress(e)}})},updateProgress:function(e){var t=_.template(this.templates.status.html());this.$progress.progressbar("value",this.$progress.progressbar("value")+1),this.$status.append(t({status_code:e.data.code,status_message:e.data.message}).trim())}});window.wpgpSettings.Import=t}(jQuery),function(e){var t=Backbone.Model.extend({initialize:function(e){this.cssLink=jQuery("link#wp-gistpen-prism-theme-css"),this.themeSelect=jQuery("#_wpgp_gistpen_highlighter_theme"),this.lnSelect=jQuery("#_wpgp_gistpen_line_numbers"),this.pre=jQuery("pre.gistpen"),this.lineNumbers=jQuery("span.line-numbers-rows")},setTheme:function(){var e=this.themeSelect.val();e="default"==e?"":"-"+e,this.cssLink.attr("href",WP_GISTPEN_URL+"assets/css/prism/themes/prism"+e+".css")},setClickHandlers:function(){var e=this;this.setTheme(),this.lnSelect.is(":checked")||(this.pre.removeClass("line-numbers"),this.lineNumbers.hide()),this.themeSelect.change(function(){e.setTheme()}),this.lnSelect.click(function(){e.lnSelect.is(":checked")?(e.pre.addClass("line-numbers"),e.lineNumbers.prependTo("pre.gistpen code"),e.lineNumbers.show()):(e.pre.removeClass("line-numbers"),e.lineNumbers.hide())})}});window.wpgpSettings.Preview=t}(jQuery);