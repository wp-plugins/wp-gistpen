function TinyMCEFileEditor(e){this.scaffoldEditor(),this.appendEditor(),this.appendPostStatusSelector(),this.loadClickHandlers(),this.deleteFileButton.remove(),this.textButton.remove(),this.aceButton.remove(),this.aceEditorDiv.remove()}var InsertGistpenDialog={appendDialog:function(){var e=this;this.dialogBody=jQuery("#wp-gistpen-insert-dialog-body"),this.dialogHTML=jQuery('<div id="wp-gistpen-insert-wrap"><form id="wp-gistpen-insert" action="" tabindex="-1"><div id="insert-existing"><p>Insert an existing Gistpen</p><div class="gistpen-search-wrap"><label class="gistpen-search-label"><label for="gistpen-search-field" class="search-label" style="display: none;">Search Gistpens</label><input type="search" id="gistpen-search-field" class="search-field" placeholder="Search Gistpens" /><div id="wp-gistpen-search-btn" class="mce-btn"><button role="button">Search</button><span class="spinner"></span></div></label></div><div id="select-gistpen" class="query-results"><div class="query-notice"><em>Recent Gistpens</em></div><ul class="gistpen-list"><!-- Add Gistpen list here --><li class="create_new_gistpen"><div class="gistpen-radio"><input type="radio" name="gistpen_id" value="new_gistpen" checked="checked"></div><div class="gistpen-title">Create a new Gistpen:</div><div class="clearfix"></div><ul><li><label for="wp-gistfile-description" style="display: none;">Gistpen description...</label><input type="text" name="wp-gistfile-description" class="wp-gistfile-description" placeholder="Gistpen description..."></input></li><li id="wp-gistfile-wrap"></li></ul></li></ul></div></div></form></div>'),this.gistpenSearchButton=this.dialogHTML.find("#wp-gistpen-search-btn"),this.dialogBody.append(this.dialogHTML),jQuery(".spinner").hide(),this.fileEditor=new TinyMCEFileEditor,this.getGistpens(),this.gistpenSearchButton.click(function(t){$this=jQuery(this),t.preventDefault(),jQuery("#select-gistpen ul.gistpen-list > li").not(".create_new_gistpen").remove(),$this.children("button").hide(),jQuery(".gistpen-search-wrap .spinner").show(),e.getGistpens()})},getGistpens:function(){jQuery.post(ajaxurl,{action:"get_gistpens",nonce:jQuery.trim(jQuery("#_ajax_wp_gistpen").val()),gistpen_search_term:jQuery.trim(jQuery("#gistpen-search-field").val())},function(e){if(e.success===!1)jQuery('<li><div class="gistpen-radio"><input type="radio" name="gistpen_id" value="none"></div><div class="gistpen-title">'+e.data.message+"</div></li>").prependTo(".gistpen-list");else for(var t=e.data,i=t.gistpens.length-1;i>=0;i--){var s=t.gistpens[i];"undefined"!=typeof s.description?s.post_name=s.description:s.post_name=s.slug,jQuery('<li><div class="gistpen-radio"><input type="radio" name="gistpen_id" value="'+s.ID+'"></div><div class="gistpen-title">'+s.post_name+"</div></li>").prependTo(".gistpen-list")}jQuery(".gistpen-search-wrap .spinner").hide(),jQuery("#wp-gistpen-search-btn button").show()})},insertShortcode:function(e){var t=this;this.gistpenid=jQuery('input[name="gistpen_id"]:checked').val(),"new_gistpen"===this.gistpenid?(jQuery("#wp-gistpen-button-insert, #wp-gistpen-button-cancel").hide(),jQuery("#wp-gistpen-insert-dialog .mce-foot .mce-container-body").append('<div class="posting">Inserting post... <span class="spinner"></span></div>'),jQuery.post(ajaxurl,{action:"create_gistpen",nonce:jQuery.trim(jQuery("#_ajax_wp_gistpen").val()),"wp-gistpenfile-slug":t.fileEditor.filenameInput.val(),"wp-gistfile-description":jQuery("input.wp-gistfile-description").val(),"wp-gistpenfile-code":t.fileEditor.editorTextArea.val(),"wp-gistpenfile-language":t.fileEditor.languageSelect.val(),post_status:t.fileEditor.post_status.val()},function(i){i.success===!1?(e.insertContent("Failed to save Gistpen. Message: "+i.data.message),e.windowManager.close()):(t.gistpenid=i.data.id,e.insertContent('[gistpen id="'+t.gistpenid+'"]'),e.windowManager.close())})):(e.insertContent('[gistpen id="'+this.gistpenid+'"]'),e.windowManager.close())}};TinyMCEFileEditor.prototype={scaffoldEditor:function(){this.editorHTML='<div class="wp-core-ui wp-editor-wrap wp-gistpenfile-editor-wrap"><div class="wp-editor-tools hide-if-no-js"><div class="wp-media-buttons"><input type="text" size="20" class="wp-gistpenfile-slug" placeholder="Filename (no ext)" autocomplete="off" /><select class="wp-gistpenfile-language"></select><input type="submit" class="button delete" value="Delete This Gistfile"></div><div class="wp-editor-tabs wp-gistpenfile-editor-tabs"><a class="hide-if-no-js wp-switch-editor switch-html">Text</a><a class="hide-if-no-js wp-switch-editor switch-ace">Ace</a></div></div><div class="wp-editor-container wp-gistpenfile-editor-container"><textarea class="wp-editor-area wp-gistpenfile-editor-area" cols="40" rows="20"></textarea><div class="ace-editor"></div></div></div>',this.editorFull=jQuery(this.editorHTML),this.editorWrap=this.editorFull.find(".wp-gistpenfile-editor-wrap"),this.editorTools=this.editorFull.find(".wp-editor-tools"),this.mediaButtons=this.editorFull.find(".wp-media-buttons"),this.filenameInput=this.editorFull.find(".wp-gistpenfile-slug"),this.languageSelect=this.editorFull.find(".wp-gistpenfile-language"),this.deleteFileButton=this.editorFull.find(".button.delete"),this.editorTabs=this.editorFull.find(".wp-gistpenfile-editor-tabs"),this.textButton=this.editorFull.find(".wp-switch-editor.switch-html"),this.aceButton=this.editorFull.find(".wp-switch-editor.switch-ace"),this.editorContainer=this.editorFull.find(".wp-gistpenfile-editor-container"),this.editorTextArea=this.editorFull.find(".wp-gistpenfile-editor-area"),this.aceEditorDiv=this.editorFull.find(".ace-editor")},appendEditor:function(){this.editorFull.appendTo(jQuery("#wp-gistfile-wrap")),this.appendLanguages()},appendLanguages:function(){var e=this;jQuery.each(gistpenLanguages,function(t,i){jQuery("<option></option>").val(i).text(t).appendTo(e.languageSelect)})},appendPostStatusSelector:function(){this.post_status=jQuery('<label for="post_status" style="display: none;">Post Status</label><select class="post_status" name="post_status"><option value="publish">Published</option><option value="draft">Draft</option></select>'),this.post_status.appendTo(this.editorFull.find(".wp-editor-tools")),this.post_status=jQuery("select.post_status")},activateAceEditor:function(){var e=this;jQuery.each(this.aceEditorDiv,function(t,i){e.aceEditor=i}),this.aceEditor=ace.edit(this.aceEditor),this.setTheme(),this.setMode(),this.switchToAce()},setTheme:function(){this.aceEditor.setTheme("ace/theme/twilight")},setMode:function(){},loadClickHandlers:function(){var e=this;this.languageSelect.change(function(){e.setMode()})},switchToText:function(){this.aceEditorDiv.hide(),this.editorTextArea.show(),this.editorWrap.addClass("html-active").removeClass("ace-active")},switchToAce:function(){this.updateAceContent(),this.editorTextArea.hide(),this.aceEditorDiv.show(),this.editorWrap.addClass("ace-active").removeClass("html-active"),this.aceEditor.focus()},deleteEditor:function(){var e=this,t=confirm("Are you sure you want to delete this Gistpen?");t!==!1&&(this.editorFull.remove(),jQuery.post(ajaxurl,{action:"delete_gistpenfile",nonce:GistpenEditor.getNonce(),fileID:e.fileID},function(t){if(t.success===!1)console.log("Failed to delete file."),console.log(t.data.message);else{var i=GistpenEditor.fileIDs.val(),s=i.replace(" "+e.fileID,"");GistpenEditor.fileIDs.val(s)}}))},updateAceContent:function(){this.aceEditor.getSession().setValue(this.editorTextArea.val())},updateTextContent:function(){this.editorTextArea.val(this.aceEditor.getValue())},addID:function(){this.filenameInput.attr({id:"wp-gistpenfile-slug-"+this.fileID,name:"wp-gistpenfile-slug-"+this.fileID}),this.languageSelect.attr({id:"wp-gistpenfile-language-"+this.fileID,name:"wp-gistpenfile-language-"+this.fileID}),this.deleteFileButton.attr({id:"wp-delete-gistpenfile-"+this.fileID,name:"wp-delete-gistpenfile-"+this.fileID}),this.editorTextArea.attr({id:"wp-gistpenfile-code-"+this.fileID,name:"wp-gistpenfile-code-"+this.fileID}),this.aceEditorDiv.attr({id:"ace-editor-"+this.fileID})},addName:function(){this.filenameInput.val(this.fileName)},addContent:function(){this.editorTextArea.val(this.fileContent)},addLanguage:function(){this.languageSelect.val(this.fileLanguage)}};