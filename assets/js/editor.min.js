window.wpgpEditor={Views:{},Models:{}},jQuery(function(e){"use strict";var t=window.wpgpEditor,i=new t.Main({post_id:e("#post_ID").val(),form:e("form#post")});t.app=i}),function(e){var t=window.wpgpEditor,i=Backbone.Collection.extend({model:function(e,i){return new t.Models.File(e,i)},initialize:function(){this.view=new t.Views.Files({collection:this}),this.on({add:this.addFile})},addFile:function(){this.view.render()}});window.wpgpEditor.Files=i}(jQuery),function(e){var t=window.wpgpEditor,i=Backbone.Model.extend({defaults:{slug:"",code:"",ID:null,language:""},initialize:function(){this.view=new t.Views.File({model:this})},deleteFile:function(){this.collection.remove(this)}});window.wpgpEditor.Models.File=i}(jQuery),function(e){var t=window.wpgpEditor,i=Backbone.Model.extend({$nonce:e("#_ajax_wp_gistpen"),defaults:{acetheme:"ambiance"},initialize:function(e,i){this.getData(),this.view=new t.Views.Main({model:this})},attachListeners:function(){this.on({"change:acetheme":this.updateThemes})},updateThemes:function(){var t=this;this.files.view.updateThemes(this.get("acetheme")),e.post(ajaxurl,{nonce:t.getNonce(),action:"save_ace_theme",theme:t.get("acetheme")},function(e,i,s){e.success===!1&&t.view.displayMessage(e.data.code,e.data.message)})},getData:function(){var i=this;e.ajaxq("getData",{url:ajaxurl,type:"POST",data:{action:"get_gistpen",nonce:i.getNonce(),post_id:i.get("post_id")}}).done(function(e){e.success===!1?i.view.displayMessage(e.data.code,e.data.message):(i.set("files",e.data.files),delete e.data.files,i.set("zip",e.data),i.zip=new t.Models.Zip(i.get("zip")),i.files=new t.Files(i.get("files")),i.get("form").prepend(i.render()))}),e.ajaxq("getData",{url:ajaxurl,type:"POST",data:{nonce:i.getNonce(),action:"get_ace_theme"}}).done(function(e){e.success===!0&&""!==e.data.theme&&(i.set("acetheme",e.data.theme),i.view.$select.val(i.get("acetheme"))),i.files.view.updateThemes(i.get("acetheme")),i.attachListeners()})},addFile:function(){var e=new t.Models.File;this.files.add(e),this.files.view.updateThemes(this.get("acetheme"))},updateGistpen:function(){var t=this;return e.ajax({url:ajaxurl,type:"POST",data:{action:"save_gistpen",nonce:t.getNonce(),zip:t.toJSON()}})},toJSON:function(){var e=_.clone(this.zip.attributes);return e.files=_.clone(this.files.toJSON()),e},getNonce:function(){return e.trim(this.$nonce.val())},render:function(){return this.view.render(),this.view.$el.prepend(this.zip.view.render().el),this.view.$el.find(".wpgp-main-settings").after(this.files.view.render().el),this.view.$el}});window.wpgpEditor.Main=i}(jQuery),function(e){var t=window.wpgpEditor,i=Backbone.Model.extend({defaults:{description:"",ID:null,status:"",password:"",sync:"off"},initialize:function(){"Auto Draft"===this.get("description")&&this.set("description",""),"auto-draft"===this.get("status")&&this.set("status","draft"),"on"!==this.get("sync")&&this.set("sync","off"),this.view=new t.Views.Zip({model:this})}});window.wpgpEditor.Models.Zip=i}(jQuery),function(e){var t=Backbone.View.extend({className:"wpgp-ace",template:_.template(e("script#wpgpFile").html()),events:{"click .switch-text":"switchToText","click .switch-ace":"switchToAce","click button":"deleteFile","change select":"updateLanguage","keyup input.wpgp-file-slug":"updateSlug","change textarea.wpgp-code":"updateCode"},render:function(){var e=this;return this.$el.html(this.template(this.model.toJSON())),this.$aceDiv=this.$el.find(".ace-editor"),this.aceDiv=this.$aceDiv.get()[0],this.$textCode=this.$el.find(".wpgp-code"),this.$wrapDiv=this.$el.find(".wp-editor-wrap"),this.$langSelect=this.$el.find(".wpgp-file-lang"),this.$slugInput=this.$el.find(".wpgp-file-slug"),this.aceEditor=ace.edit(this.aceDiv),this.aceEditor.getSession().on("change",function(t){e.updateTextContent()}),""===this.model.get("language")&&this.model.set("language","plaintext"),this.$langSelect.val(this.model.get("language")),this.updateLanguage(),this.switchToAce(),this},switchToAce:function(){this.updateAceContent(),this.$textCode.hide(),this.$aceDiv.show(),this.$wrapDiv.addClass("ace-active").removeClass("html-active"),this.aceEditor.focus()},updateAceContent:function(){this.aceEditor.getSession().setValue(this.$textCode.val())},switchToText:function(){this.$aceDiv.hide(),this.$textCode.show(),this.$wrapDiv.removeClass("ace-active").addClass("html-active")},updateTextContent:function(){this.$textCode.val(this.aceEditor.getValue()),this.updateCode()},deleteFile:function(e){e.preventDefault(),this.$el.remove(),this.model.deleteFile()},updateLanguage:function(){modelLang=this.$langSelect.val(),(""===modelLang||null===modelLang)&&(modelLang="bash"),this.model.set("language",modelLang),"js"===modelLang?this.aceEditor.getSession().setMode("ace/mode/javascript"):"bash"===modelLang?this.aceEditor.getSession().setMode("ace/mode/sh"):"c"===modelLang||"cpp"===modelLang||"swift"===modelLang?this.aceEditor.getSession().setMode("ace/mode/c_cpp"):"coffeescript"===modelLang?this.aceEditor.getSession().setMode("ace/mode/coffee"):"php"===modelLang?this.aceEditor.getSession().setMode({path:"ace/mode/php",inline:!0}):"plaintext"===modelLang||"http"===modelLang?this.aceEditor.getSession().setMode("ace/mode/plain_text"):"py"===modelLang?this.aceEditor.getSession().setMode("ace/mode/python"):"go"===modelLang?this.aceEditor.getSession().setMode("ace/mode/golang"):"git"===modelLang?this.aceEditor.getSession().setMode("ace/mode/diff"):"nasm"===modelLang?this.aceEditor.getSession().setMode("ace/mode/assembly_x86"):this.aceEditor.getSession().setMode("ace/mode/"+modelLang)},updateSlug:function(){this.model.set("slug",this.$slugInput.val())},updateCode:function(){this.model.set("code",this.$textCode.val())},updateTheme:function(e){this.aceEditor.setTheme("ace/theme/"+e)}});window.wpgpEditor.Views.File=t}(jQuery),function(e){var t=Backbone.View.extend({id:"wpgp-files",render:function(){return this.collection.each(this.addAce,this),this},addAce:function(e,t){this.$el.append(e.view.render().el)},updateThemes:function(e){this.collection.each(function(t,i){t.view.updateTheme(e)})}});window.wpgpEditor.Views.Files=t}(jQuery),function(e){var t=Backbone.View.extend({id:"wpgp-editor",template:_.template(e("script#wpgpMain").html()),events:{"change select":"updateTheme","click input#wpgp-addfile":"addFile","click input#wpgp-update":"updateGistpen"},render:function(){return this.$el.append(this.template()),this.$select=this.$el.find("select"),this.$addFile=this.$el.find("input#wpgp-addfile"),this.$updateGistpen=this.$el.find("input#wpgp-update"),this.$spinner=this.$el.find("span.spinner"),this},updateTheme:function(){this.model.set("acetheme",this.$select.val())},addFile:function(e){e.preventDefault(),this.model.addFile()},updateGistpen:function(e){var t=this;e.preventDefault(),this.$spinner.toggle(),this.$updateGistpen.prop("disabled",!0),this.model.updateGistpen().done(function(e){t.displayMessage(e.data.code,e.data.message),t.$updateGistpen.prop("disabled",!1),t.$spinner.toggle()})},displayMessage:function(t,i){var s=e('<div class="'+t+'"><p>'+i+"</p></div>");s.hide().prependTo(this.$el).slideDown("slow").delay("2000").slideUp("slow")}});window.wpgpEditor.Views.Main=t}(jQuery),function(e){var t=Backbone.View.extend({id:"wpgp-zip",template:_.template(e("script#wpgpZip").html()),events:{"keyup input#title":"updateDescription","change select#wpgp-zip-status":"updateLanguage","click .wpgp-sync":"updateSync"},render:function(){var e;return this.$el.html(this.template(this.model.toJSON())),this.$inputDescription=this.$el.find("#title"),this.$labelDescription=this.$el.find("#title-prompt-text"),this.$selectStatus=this.$("#wpgp-zip-status"),this.$inputSync=this.$("#wpgp-zip-sync"),""!==this.model.get("description")&&this.$labelDescription.addClass("screen-reader-text"),this.$selectStatus.val(this.model.get("status")),e="on"===this.model.get("sync")?!0:!1,this.$inputSync.prop("checked",e),this.addListeners(),this},addListeners:function(){that=this,this.$labelDescription.click(function(){that.$labelDescription.addClass("screen-reader-text"),that.$inputDescription.focus()}),this.$inputDescription.blur(function(){""===this.value&&that.$labelDescription.removeClass("screen-reader-text")}).focus(function(){that.$labelDescription.addClass("screen-reader-text")}).keydown(function(e){that.$labelDescription.addClass("screen-reader-text")})},updateDescription:function(){this.model.set("description",this.$inputDescription.val())},updateLanguage:function(){this.model.set("status",this.$selectStatus.val())},updateSync:function(){var e;e=!0===this.$inputSync.prop("checked")?"on":"off",this.model.set("sync",e)}});window.wpgpEditor.Views.Zip=t}(jQuery);